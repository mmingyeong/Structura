2025-04-21 21:00:25,771 - ERROR - Unhandled exception occurred:
Traceback (most recent call last):
  File "/caefs/user/mmingyeong/structura/Structura/src/example/density_kde_seq_chunks/00_TestDensity.py", line 199, in <module>
    warm_calc.calculate_density_map(kernel_func=kernel_func, h=bandwidth, use_lut=use_lut)
  File "/caefs/user/mmingyeong/structura/Structura/src/density.py", line 201, in calculate_density_map
    particle_centered_density_triangular(
  File "/home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/core/dispatcher.py", line 424, in _compile_for_args
    error_rewrite(e, 'typing')
  File "/home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/core/dispatcher.py", line 365, in error_rewrite
    raise e.with_traceback(None)
numba.core.errors.TypingError: Failed in nopython mode pipeline (step: nopython frontend)
Failed in nopython mode pipeline (step: nopython frontend)
No implementation of function Function(<function clip at 0x7fbeb9e45e10>) found for signature:
 
 >>> clip(int64, Literal[int](0), int64)
 
There are 2 candidate implementations:
  - Of which 2 did not match due to:
  Overload in function 'np_clip': File: numba/np/arrayobj.py: Line 2333.
    With argument(s): '(int64, int64, int64)':
   Rejected as the implementation raised a specific error:
     TypingError: Failed in nopython mode pipeline (step: nopython frontend)
   Unknown attribute 'shape' of type int64
   
   File "../../../../../../../../home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/np/arrayobj.py", line 2372:
           def np_clip_ss(a, a_min, a_max, out=None):
               <source elided>
               ret = np.empty_like(a) if out is None else out
               for index in np.ndindex(a.shape):
               ^
   
   During: typing of get attribute at /home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/np/arrayobj.py (2372)
   
   File "../../../../../../../../home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/np/arrayobj.py", line 2372:
           def np_clip_ss(a, a_min, a_max, out=None):
               <source elided>
               ret = np.empty_like(a) if out is None else out
               for index in np.ndindex(a.shape):
               ^
   
   During: Pass nopython_type_inference
  raised from /home/users/mmingyeong/.conda/envs/new_env/lib/python3.10/site-packages/numba/core/typeinfer.py:1074

During: resolving callee type: Function(<function clip at 0x7fbeb9e45e10>)
During: typing of call at /caefs/user/mmingyeong/structura/Structura/src/density.py (55)


File "../../density.py", line 55:
def fast_sqrt_lut(x, table_x, table_y):
    <source elided>
    idx = np.searchsorted(table_x, x) - 1
    idx = np.clip(idx, 0, len(table_x) - 2)
    ^

During: Pass nopython_type_inference
During: resolving callee type: type(CPUDispatcher(<function fast_sqrt_lut at 0x7fbe5da89c60>))
During: typing of call at /caefs/user/mmingyeong/structura/Structura/src/density.py (150)

During: resolving callee type: type(CPUDispatcher(<function fast_sqrt_lut at 0x7fbe5da89c60>))
During: typing of call at /caefs/user/mmingyeong/structura/Structura/src/density.py (150)


File "../../density.py", line 150:
def particle_centered_density_triangular(particles, density_map,
    <source elided>
                    if sq <= h2:
                        dist = fast_sqrt_lut(sq, table_x, table_y) if use_lut else np.sqrt(sq)
                        ^

During: Pass nopython_type_inference
